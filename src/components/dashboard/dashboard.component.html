<div class="min-h-screen bg-gray-50 font-sans pb-10 print:bg-white">
  <!-- Header -->
  <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40 animate-slide-up print:hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">
        <div class="flex items-center gap-4">
          <!-- Logo matching login theme -->
          <div class="w-12 h-12 bg-gradient-to-b from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-200 transform hover:rotate-6 transition-transform duration-300">
            <i class="fas fa-graduation-cap text-2xl text-white"></i>
          </div>
          <div>
            <h1 class="text-xl font-extrabold text-gray-800 tracking-tight">E-SPP <span class="text-teal-500">Dashboard</span></h1>
            <p class="text-xs text-gray-500 font-medium">Sistem Pembayaran Terpadu</p>
          </div>
        </div>
        
        <div class="flex items-center gap-6">
          <div class="text-right hidden sm:block">
            <p class="font-bold text-gray-800 text-sm">{{ currentUser()?.name }}</p>
            <span class="inline-block px-3 py-0.5 rounded-full bg-blue-50 text-blue-600 text-[10px] font-bold uppercase tracking-wider border border-blue-100">
              {{ currentUser()?.role }}
            </span>
          </div>
          <!-- Logout Button Styled -->
          <button (click)="requestLogout()" class="w-10 h-10 rounded-xl bg-red-50 text-red-500 hover:bg-red-500 hover:text-white hover:shadow-lg hover:shadow-red-200 transition-all duration-300 flex items-center justify-center group" title="Keluar Aplikasi">
            <i class="fas fa-sign-out-alt text-lg group-hover:scale-110 transition-transform"></i>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 print:p-0">
    @switch (currentUser()?.role) {
      
      <!-- 1. DASHBOARD SUPERADMIN -->
      @case ('Superadmin') {
        <div class="space-y-8 animate-slide-up delay-100">
          
          <!-- Input / Output Control Center -->
          <div class="bg-gradient-to-r from-slate-800 to-slate-900 rounded-[2rem] p-8 text-white shadow-xl shadow-slate-200 relative overflow-hidden">
              <div class="absolute right-0 top-0 opacity-10 p-4">
                  <i class="fas fa-database text-9xl"></i>
              </div>
              
              <h2 class="text-2xl font-bold mb-2">Pusat Data & Pengelolaan</h2>
              <p class="text-slate-400 mb-8 max-w-xl">Kelola data master sistem. Lakukan Import data siswa baru atau Export laporan lengkap dalam format Excel asli.</p>
              
              <div class="flex flex-col sm:flex-row gap-4 relative z-10">
                  <!-- INPUT BUTTON -->
                  <button (click)="triggerImport()" class="flex-1 bg-emerald-500 hover:bg-emerald-400 text-white p-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-emerald-500/30 flex items-center justify-center gap-3 group">
                      <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                          <i class="fas fa-file-import text-xl"></i>
                      </div>
                      <div class="text-left">
                          <span class="block text-xs text-emerald-100 uppercase tracking-wider">Input Data</span>
                          <span class="text-lg">Import Excel</span>
                      </div>
                  </button>

                  <!-- OUTPUT BUTTON -->
                  <button (click)="exportDataExcel()" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-xl font-bold transition-all shadow-lg hover:shadow-blue-600/30 flex items-center justify-center gap-3 group">
                       <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                          <i class="fas fa-file-excel text-xl"></i>
                      </div>
                      <div class="text-left">
                          <span class="block text-xs text-blue-100 uppercase tracking-wider">Output Data</span>
                          <span class="text-lg">Export .XLSX</span>
                      </div>
                  </button>
              </div>
          </div>

          <!-- Statistics Row -->
           <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 relative overflow-hidden group border border-slate-100">
                 <div class="absolute top-0 left-0 w-full h-1.5 bg-indigo-500"></div>
                  <h3 class="text-gray-400 font-bold text-sm uppercase mb-1">Total Pengguna</h3>
                  <p class="text-3xl font-extrabold text-gray-800 mb-4">{{ allStudents().length + 4 }} <span class="text-sm font-normal text-gray-500">Akun Terdaftar</span></p>
                  <div class="text-indigo-600 text-xs font-bold flex items-center gap-1">
                      <i class="fas fa-check-circle"></i> Data Sinkron
                  </div>
              </div>

              <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 relative overflow-hidden group border border-slate-100">
                 <div class="absolute top-0 left-0 w-full h-1.5 bg-teal-500"></div>
                  <h3 class="text-gray-400 font-bold text-sm uppercase mb-1">Total Transaksi</h3>
                  <!-- Simple calc for demo -->
                  <p class="text-3xl font-extrabold text-gray-800 mb-4">248 <span class="text-sm font-normal text-gray-500">Records</span></p>
                  <div class="text-teal-600 text-xs font-bold flex items-center gap-1">
                      <i class="fas fa-database"></i> Database Active
                  </div>
              </div>

              <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 relative overflow-hidden group border border-slate-100">
                 <div class="absolute top-0 left-0 w-full h-1.5 bg-red-500"></div>
                  <h3 class="text-gray-400 font-bold text-sm uppercase mb-1">Log Sistem</h3>
                  <p class="text-3xl font-extrabold text-gray-800 mb-4">{{ systemLogs().length }} <span class="text-sm font-normal text-gray-500">Aktivitas</span></p>
                  <div class="text-green-600 text-xs font-bold flex items-center gap-1">
                    <i class="fas fa-shield-alt"></i> Aman
                  </div>
              </div>
           </div>

           <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
               <!-- User Management Table -->
               <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 overflow-hidden relative border border-gray-100">
                  <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50/50">
                    <h3 class="font-extrabold text-gray-900 flex items-center gap-2"><i class="fas fa-users text-indigo-500"></i> Manajemen User</h3>
                    <button class="w-8 h-8 rounded-full bg-indigo-100 text-indigo-600 hover:bg-indigo-600 hover:text-white transition flex items-center justify-center">
                        <i class="fas fa-plus"></i>
                    </button>
                  </div>
                  <div class="p-0 overflow-x-auto max-h-80">
                      <table class="w-full text-sm text-left">
                          <thead class="text-xs text-gray-400 uppercase bg-gray-50 sticky top-0">
                              <tr>
                                  <th class="px-6 py-3">User</th>
                                  <th class="px-6 py-3">Role</th>
                                  <th class="px-6 py-3 text-right">Aksi</th>
                              </tr>
                          </thead>
                          <tbody class="divide-y divide-gray-50">
                              @for(student of allStudents(); track student.id) {
                                  <tr class="hover:bg-gray-50 transition">
                                      <td class="px-6 py-3 font-medium">{{ student.name }} <br> <span class="text-xs text-gray-400">{{student.id}}</span></td>
                                      <td class="px-6 py-3"><span class="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-xs font-bold">{{ student.role }}</span></td>
                                      <td class="px-6 py-3 text-right">
                                          <button class="text-gray-400 hover:text-blue-500 mx-1"><i class="fas fa-edit"></i></button>
                                          <button class="text-gray-400 hover:text-red-500 mx-1"><i class="fas fa-trash"></i></button>
                                      </td>
                                  </tr>
                              }
                          </tbody>
                      </table>
                  </div>
               </div>

               <!-- System Audit Log -->
               <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 overflow-hidden relative border border-gray-100">
                  <div class="p-6 border-b border-gray-100 bg-gray-50/50">
                    <h3 class="font-extrabold text-gray-900 flex items-center gap-2"><i class="fas fa-history text-slate-500"></i> Audit Log</h3>
                  </div>
                  <div class="p-0 overflow-y-auto max-h-80">
                      <div class="divide-y divide-gray-50">
                          @for(log of systemLogs(); track log.id) {
                            <div class="p-4 hover:bg-slate-50 transition flex gap-3 items-start">
                                <div class="mt-1">
                                    @if(log.type === 'Info') { <i class="fas fa-info-circle text-blue-400"></i> }
                                    @if(log.type === 'Warning') { <i class="fas fa-exclamation-triangle text-amber-400"></i> }
                                </div>
                                <div>
                                    <p class="text-sm font-bold text-gray-800">{{ log.action }} <span class="text-xs font-normal text-gray-500">by {{ log.user }}</span></p>
                                    <p class="text-xs text-gray-500">{{ log.details }}</p>
                                    <p class="text-[10px] text-gray-400 mt-1 font-mono">{{ log.timestamp }}</p>
                                </div>
                            </div>
                          }
                      </div>
                  </div>
               </div>
           </div>
        </div>
      }

      <!-- 2. DASHBOARD BENDAHARA -->
      @case ('Bendahara') {
        <div class="space-y-8 animate-slide-up delay-100">
           <!-- Top Section: Input & Quick Stats -->
           <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
               
               <!-- Payment Form -->
               <div class="lg:col-span-2 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-[2rem] shadow-xl shadow-emerald-100 p-8 text-white relative overflow-hidden">
                   <div class="absolute right-0 bottom-0 opacity-10 transform translate-x-10 translate-y-10">
                       <i class="fas fa-cash-register text-9xl"></i>
                   </div>
                   
                   <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                       <i class="fas fa-money-bill-wave"></i> Input Transaksi Baru
                   </h2>

                   <!-- Search Step -->
                   <div class="flex gap-4 mb-6 relative z-10">
                       <input type="text" [(ngModel)]="searchNis" placeholder="Cari NIS Siswa..." class="flex-1 px-6 py-4 rounded-2xl text-gray-800 font-bold focus:outline-none focus:ring-4 focus:ring-emerald-300/50 shadow-lg placeholder-gray-400">
                       <button (click)="searchStudent()" class="bg-white text-emerald-600 px-6 py-4 rounded-2xl font-extrabold hover:bg-emerald-50 transition-colors shadow-lg">
                           <i class="fas fa-search"></i>
                       </button>
                   </div>

                   <!-- Found Student Result -->
                   @if (foundStudent(); as s) {
                    <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20 animate-fade-in">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold">{{ s.name }}</h3>
                                <p class="text-emerald-100 text-sm">{{ s.kelas }} | NIS: {{ s.id }}</p>
                            </div>
                            <span class="bg-white text-emerald-600 px-3 py-1 rounded-full text-xs font-bold">{{ s.statusSiswa }}</span>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="text-xs text-emerald-100 uppercase font-bold">Jenis Pembayaran</label>
                                <select class="w-full mt-1 px-3 py-2 rounded-lg bg-emerald-700/50 border border-emerald-500 focus:outline-none text-sm font-bold">
                                    <option>SPP Bulanan</option>
                                    <option>Daftar Ulang</option>
                                    <option>Uang Gedung</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs text-emerald-100 uppercase font-bold">Bulan</label>
                                <select [(ngModel)]="selectedMonth" class="w-full mt-1 px-3 py-2 rounded-lg bg-emerald-700/50 border border-emerald-500 focus:outline-none text-sm font-bold">
                                    <option>Juli</option>
                                    <option>Agustus</option>
                                    <option>September</option>
                                    <option>Oktober</option>
                                    <option>November</option>
                                    <option>Desember</option>
                                    <option>Januari</option>
                                    <option>Februari</option>
                                    <option>Maret</option>
                                    <option>April</option>
                                    <option>Mei</option>
                                    <option>Juni</option>
                                </select>
                            </div>
                        </div>

                        <button (click)="processPayment()" class="w-full bg-emerald-300 text-emerald-900 font-bold py-3 rounded-xl hover:bg-white transition-colors shadow-lg">
                            <i class="fas fa-save mr-2"></i> Simpan Pembayaran (Rp {{ s.nominalSpp.toLocaleString('id-ID') }})
                        </button>
                    </div>
                   }
               </div>

               <!-- Quick Actions & Daily Recap -->
               <div class="space-y-6">
                   <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-gray-100">
                       <h3 class="text-gray-500 text-xs font-bold uppercase mb-2">Pemasukan Hari Ini</h3>
                       <p class="text-3xl font-extrabold text-gray-800">Rp 600.000</p>
                       <p class="text-xs text-green-500 mt-1 font-bold">+ 2 Transaksi</p>
                   </div>

                   <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-gray-100">
                        <h3 class="text-gray-500 text-xs font-bold uppercase mb-4">Menu Cepat</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button (click)="printReport()" class="p-3 bg-blue-50 text-blue-600 rounded-xl text-xs font-bold hover:bg-blue-100 transition flex flex-col items-center gap-2">
                                <i class="fas fa-file-export text-lg"></i> Export
                            </button>
                            <button class="p-3 bg-purple-50 text-purple-600 rounded-xl text-xs font-bold hover:bg-purple-100 transition flex flex-col items-center gap-2">
                                <i class="fas fa-list text-lg"></i> Tunggakan
                            </button>
                        </div>
                   </div>
               </div>
           </div>

           <!-- Recent Transactions Table -->
           <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 overflow-hidden relative border border-gray-100">
              <div class="p-8 border-b border-gray-100 flex justify-between items-center">
                <div class="flex items-center gap-4">
                   <div class="w-12 h-12 bg-emerald-50 rounded-2xl flex items-center justify-center text-emerald-600 border border-emerald-100">
                      <i class="fas fa-history text-xl"></i>
                   </div>
                   <div>
                      <h2 class="text-xl font-extrabold text-gray-900">Transaksi Terakhir</h2>
                      <p class="text-gray-500 text-sm">Realtime data entry</p>
                   </div>
                </div>
              </div>
              
              <div class="overflow-x-auto p-2">
                <table class="w-full text-sm text-left">
                  <thead class="text-xs text-gray-500 uppercase bg-gray-50/50">
                    <tr>
                      <th class="px-6 py-4 rounded-l-xl font-bold">Tanggal</th>
                      <th class="px-6 py-4 font-bold">Siswa</th>
                      <th class="px-6 py-4 font-bold">Keterangan</th>
                      <th class="px-6 py-4 rounded-r-xl font-bold text-right">Nominal</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-50">
                    @for (trx of recentTransactions(); track trx.id) {
                      <tr class="hover:bg-emerald-50/30 transition-colors">
                        <td class="px-6 py-5 font-mono text-gray-500 text-xs">{{ trx.date }}</td>
                        <td class="px-6 py-5 font-bold text-gray-800">{{ trx.studentName }} <span class="text-xs font-normal text-gray-500">({{trx.studentClass}})</span></td>
                        <td class="px-6 py-5"><span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-bold">SPP {{ trx.month }}</span></td>
                        <td class="px-6 py-5 text-right font-bold text-emerald-600">Rp {{ trx.amount.toLocaleString('id-ID') }}</td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
           </div>
        </div>
      }

      <!-- 3. DASHBOARD KEPALA SEKOLAH -->
      @case ('KepalaSekolah') {
        <div class="space-y-8 animate-slide-up delay-100">
          <div class="flex items-center gap-4 mb-4">
              <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center shadow-inner">
                  <i class="fas fa-chart-pie text-3xl text-purple-600"></i>
              </div>
              <div>
                  <h2 class="text-2xl font-extrabold text-gray-900">Executive Dashboard</h2>
                  <p class="text-gray-500">Ringkasan Eksekutif & Statistik</p>
              </div>
          </div>

          <!-- KPI Cards -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
             <!-- Card 1: Total SPP -->
             <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-purple-50 relative overflow-hidden group hover:shadow-2xl hover:shadow-purple-100 transition-all">
                <div class="absolute right-0 top-0 p-4 opacity-10">
                   <i class="fas fa-money-bill text-6xl text-purple-600"></i>
                </div>
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Total SPP Terbayar</p>
                <h3 class="text-2xl font-extrabold text-purple-700 font-mono">Rp {{ financialStats().totalSPP.toLocaleString('id-ID') }}</h3>
                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-4 overflow-hidden"><div class="bg-purple-500 h-1.5 rounded-full" style="width: 70%"></div></div>
             </div>

             <!-- Card 2: Total DU (New) -->
             <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-teal-50 relative overflow-hidden group hover:shadow-2xl hover:shadow-teal-100 transition-all">
                <div class="absolute right-0 top-0 p-4 opacity-10">
                   <i class="fas fa-building text-6xl text-teal-600"></i>
                </div>
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Total Uang Gedung/DU</p>
                <h3 class="text-2xl font-extrabold text-teal-600 font-mono">Rp {{ financialStats().totalDU.toLocaleString('id-ID') }}</h3>
                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-4 overflow-hidden"><div class="bg-teal-500 h-1.5 rounded-full" style="width: 45%"></div></div>
             </div>

             <!-- Card 3: Total Tunggakan -->
             <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-red-50 relative overflow-hidden group hover:shadow-2xl hover:shadow-red-100 transition-all">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Total Tunggakan</p>
                <h3 class="text-2xl font-extrabold text-red-600 font-mono">Rp {{ financialStats().totalArrears.toLocaleString('id-ID') }}</h3>
                <div class="w-full bg-gray-100 h-1.5 rounded-full mt-4 overflow-hidden"><div class="bg-red-500 h-1.5 rounded-full" style="width: 35%"></div></div>
             </div>

             <!-- Card 4: Siswa Aktif -->
             <div class="bg-white rounded-[2rem] p-6 shadow-xl shadow-gray-100 border border-gray-50 relative overflow-hidden">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Siswa Aktif</p>
                <h3 class="text-2xl font-extrabold text-gray-800">{{ financialStats().studentCount }}</h3>
                <p class="text-xs text-gray-400 mt-1">Tahun Ajaran 2023/2024</p>
             </div>
          </div>

          <!-- Chart Visuals & Class Stats -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
             <!-- Visual Bar Chart (CSS) -->
             <div class="lg:col-span-2 bg-white rounded-[2rem] shadow-xl shadow-gray-100 p-8 border border-gray-100">
                <h3 class="font-bold text-gray-900 mb-6 flex items-center gap-2"><i class="fas fa-chart-bar text-purple-500"></i> Arus Kas Bulanan (Tahun Ajaran)</h3>
                <div class="flex items-end justify-between h-64 gap-2 pt-4 border-b border-gray-100 pb-2">
                    @for(income of financialStats().monthlyIncome; track $index) {
                        <div class="w-full bg-purple-50 rounded-t-lg relative group hover:bg-purple-100 transition-all cursor-pointer" [style.height.%]="(income / 20000000) * 100">
                             <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition">
                                 {{ (income/1000000).toFixed(1) }}jt
                             </div>
                        </div>
                    }
                </div>
                <!-- Updated Months Order: July -> June -->
                <div class="flex justify-between text-[10px] text-gray-400 font-bold uppercase mt-2">
                    <span>Jul</span><span>Ags</span><span>Sep</span><span>Okt</span><span>Nov</span><span>Des</span>
                    <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>Mei</span><span>Jun</span>
                </div>
             </div>

             <!-- Class Leaderboard -->
             <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 p-8 border border-gray-100">
                 <h3 class="font-bold text-gray-900 mb-4">Kepatuhan Pembayaran</h3>
                 <div class="space-y-4">
                     <div class="flex items-center justify-between">
                         <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-full bg-gold-100 flex items-center justify-center text-yellow-500 font-bold text-xs border border-yellow-200">1</div>
                             <span class="text-sm font-bold text-gray-700">XII IPA 1</span>
                         </div>
                         <span class="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">98% Lunas</span>
                     </div>
                     <div class="flex items-center justify-between">
                         <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 font-bold text-xs border border-gray-200">2</div>
                             <span class="text-sm font-bold text-gray-700">X IPA 2</span>
                         </div>
                         <span class="text-xs font-bold text-green-600 bg-green-50 px-2 py-1 rounded">92% Lunas</span>
                     </div>
                     <div class="flex items-center justify-between opacity-60">
                         <div class="flex items-center gap-3">
                             <div class="w-8 h-8 rounded-full bg-orange-50 flex items-center justify-center text-orange-500 font-bold text-xs border border-orange-100">3</div>
                             <span class="text-sm font-bold text-gray-700">XI IPS 1</span>
                         </div>
                         <span class="text-xs font-bold text-orange-600 bg-orange-50 px-2 py-1 rounded">75% Lunas</span>
                     </div>
                 </div>
                 <button class="w-full mt-6 py-3 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-xs font-bold hover:border-purple-300 hover:text-purple-500 transition">
                     Lihat Semua Kelas
                 </button>
             </div>
          </div>
        </div>
      }

      <!-- 4. DASHBOARD WAKIL SARANA -->
      @case ('WakilSarana') {
        <div class="space-y-8 animate-slide-up delay-100">
           <!-- Budget & Request Form -->
           <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
               <div class="bg-gradient-to-br from-orange-400 to-amber-500 rounded-[2rem] shadow-xl shadow-orange-100 p-8 text-white relative overflow-hidden">
                    <div class="absolute right-0 top-0 p-6 opacity-20">
                        <i class="fas fa-tools text-8xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-1">Anggaran Sarana</h2>
                    <p class="text-orange-100 text-sm mb-6">Tahun Anggaran 2024</p>
                    
                    <div class="bg-white/20 backdrop-blur-md rounded-xl p-6 mb-6 border border-white/30">
                        <p class="text-xs font-bold uppercase tracking-wider mb-1 text-orange-50">Dana Tersedia</p>
                        <p class="text-4xl font-extrabold font-mono tracking-tight">Rp {{ saranaBudget().toLocaleString('id-ID') }}</p>
                        <div class="mt-4 w-full bg-black/20 h-2 rounded-full overflow-hidden">
                            <div class="bg-white h-2 rounded-full" style="width: 75%"></div>
                        </div>
                        <p class="text-[10px] text-right mt-1 text-orange-100">75% Terserap</p>
                    </div>
               </div>

               <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 p-8 border border-gray-100">
                   <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                       <i class="fas fa-plus-circle text-orange-500"></i> Buat Pengajuan Baru
                   </h3>
                   <div class="space-y-4">
                       <div>
                           <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Judul Perbaikan</label>
                           <input [(ngModel)]="newRequest().title" type="text" class="w-full px-4 py-2 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-orange-300 outline-none" placeholder="Contoh: Perbaikan AC Ruang Guru">
                       </div>
                       <div>
                           <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Estimasi Biaya</label>
                           <input [(ngModel)]="newRequest().cost" type="number" class="w-full px-4 py-2 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-orange-300 outline-none" placeholder="0">
                       </div>
                       <button (click)="submitMaintenanceRequest()" class="w-full bg-orange-500 text-white font-bold py-3 rounded-xl hover:bg-orange-600 transition shadow-lg shadow-orange-200">
                           Kirim Pengajuan
                       </button>
                   </div>
               </div>
           </div>

           <!-- Requests List -->
           <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 overflow-hidden relative border border-gray-100">
               <div class="p-8 border-b border-gray-100 bg-gray-50/50">
                  <h2 class="text-xl font-extrabold text-gray-900">Riwayat Pengajuan</h2>
               </div>
               
               <div class="p-0">
                   @for(req of maintenanceRequests(); track req.id) {
                     <div class="p-6 border-b border-gray-50 flex flex-col md:flex-row md:items-center justify-between hover:bg-orange-50/20 transition gap-4">
                         <div class="flex items-start gap-4">
                            <div class="w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 
                                {{ req.priority === 'Tinggi' ? 'bg-red-100 text-red-500' : 'bg-blue-100 text-blue-500' }}">
                                <i class="fas {{ req.priority === 'Tinggi' ? 'fa-exclamation-circle' : 'fa-wrench' }}"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 text-lg">{{ req.title }}</h4>
                                <p class="text-sm text-gray-500">{{ req.description }}</p>
                                <div class="flex items-center gap-3 mt-2">
                                    <span class="text-xs font-mono bg-gray-100 px-2 py-0.5 rounded text-gray-600">{{ req.requestDate }}</span>
                                    <span class="text-xs font-bold text-gray-500">Est: Rp {{ req.costEstimate.toLocaleString('id-ID') }}</span>
                                </div>
                            </div>
                         </div>
                         <div class="text-right">
                             @if(req.status === 'Selesai') {
                                 <span class="px-4 py-2 bg-green-100 text-green-700 rounded-xl text-xs font-bold border border-green-200 inline-block">Selesai</span>
                             } @else if(req.status === 'Diproses') {
                                 <span class="px-4 py-2 bg-yellow-100 text-yellow-700 rounded-xl text-xs font-bold border border-yellow-200 inline-block">Sedang Dikerjakan</span>
                             } @else {
                                 <span class="px-4 py-2 bg-gray-100 text-gray-600 rounded-xl text-xs font-bold border border-gray-200 inline-block">Menunggu Persetujuan</span>
                             }
                         </div>
                     </div>
                   }
               </div>
           </div>
        </div>
      }

      <!-- 5. DASHBOARD SISWA -->
      @case ('Siswa') {
        @if (studentData(); as student) {
          <div class="space-y-8 animate-slide-up delay-100">
            <!-- Student Profile Card -->
            <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 p-8 relative overflow-hidden group hover:shadow-2xl hover:shadow-blue-50 transition-all duration-500">
              <div class="absolute top-0 left-0 w-full h-1.5 bg-teal-400"></div>
              
              <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
                <div class="flex items-center gap-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-teal-400 to-blue-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-teal-200">
                        <i class="fas fa-user-graduate text-3xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-extrabold text-gray-900">{{ student.name }}</h2>
                        <p class="text-gray-500 font-mono text-sm">{{ student.id }} | {{ student.kelas }}</p>
                    </div>
                </div>
                <div class="flex flex-col items-end gap-2">
                    <div class="px-4 py-1.5 bg-green-50 rounded-lg border border-green-100 text-green-700 font-bold text-xs flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span> {{ student.statusSiswa }}
                    </div>
                </div>
              </div>

              <!-- Alerts -->
              <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-xl mb-6">
                  <div class="flex items-center gap-3">
                      <i class="fas fa-bell text-amber-500"></i>
                      <div>
                          <p class="text-sm font-bold text-amber-800">Tagihan Bulan Ini</p>
                          <p class="text-xs text-amber-700">SPP Bulan Mei 2024 belum dibayarkan. Jatuh tempo tgl 10.</p>
                      </div>
                  </div>
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                  <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-center">
                      <p class="text-xs text-gray-400 font-bold uppercase">Total Terbayar</p>
                      <p class="text-lg font-extrabold text-gray-800">Rp 4.500.000</p>
                  </div>
                   <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-center">
                      <p class="text-xs text-gray-400 font-bold uppercase">Sisa Tagihan</p>
                      <p class="text-lg font-extrabold text-red-500">Rp 600.000</p>
                  </div>
                  <div class="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-center">
                      <p class="text-xs text-gray-400 font-bold uppercase">Nominal SPP</p>
                      <p class="text-lg font-extrabold text-blue-600">Rp {{ student.nominalSpp.toLocaleString('id-ID') }}</p>
                  </div>
              </div>
            </div>

            <!-- Payment History Table -->
            <div class="bg-white rounded-[2rem] shadow-xl shadow-gray-100 overflow-hidden relative border border-gray-100">
               <div class="absolute top-0 left-0 w-full h-1.5 bg-teal-400 z-10"></div>
               <div class="p-8 border-b border-gray-100">
                    <h2 class="text-xl font-extrabold text-gray-900">Riwayat Pembayaran</h2>
               </div>
              
              <div class="overflow-x-auto p-2">
                <table class="w-full text-sm text-left">
                  <thead class="text-xs text-gray-500 uppercase bg-gray-50/50">
                    <tr>
                      <th class="px-6 py-4 rounded-l-xl font-bold">Periode</th>
                      <th class="px-6 py-4 font-bold">Nominal</th>
                      <th class="px-6 py-4 font-bold">Tgl Bayar</th>
                      <th class="px-6 py-4 font-bold text-center">Status</th>
                      <th class="px-6 py-4 rounded-r-xl font-bold text-center">Kuitansi</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-50">
                    @for (payment of student.paymentHistory; track payment.id) {
                      <tr class="hover:bg-blue-50/30 transition-colors group">
                        <td class="px-6 py-5">
                            <div class="font-bold text-gray-800">{{ payment.bulan }}</div>
                            <div class="text-xs text-gray-400">{{ payment.tahun }}</div>
                        </td>
                        <td class="px-6 py-5 font-mono font-medium text-gray-600">
                            Rp {{ payment.jumlah.toLocaleString('id-ID') }}
                        </td>
                        <td class="px-6 py-5 text-gray-500">
                            {{ payment.tanggalBayar || '-' }}
                        </td>
                        <td class="px-6 py-5 text-center">
                            @if (payment.status === 'Lunas') {
                                <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-green-100 text-green-700">LUNAS</span>
                            } @else {
                                <span class="px-3 py-1 rounded-full text-[10px] font-bold bg-red-100 text-red-700">BELUM</span>
                            }
                        </td>
                        <td class="px-6 py-5 text-center">
                            @if (payment.status === 'Lunas') {
                                <button (click)="downloadReceipt(payment.id)" class="text-blue-500 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 p-2 rounded-lg transition" title="Unduh Kuitansi">
                                    <i class="fas fa-download"></i>
                                </button>
                            } @else {
                                <span class="text-gray-300"><i class="fas fa-lock"></i></span>
                            }
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        }
      }
    }
  </main>
</div>

@if (showLogoutConfirmation()) {
  <app-confirmation-dialog
    title="Konfirmasi Keluar"
    message="Anda akan mengakhiri sesi ini."
    (confirm)="confirmLogout()"
    (cancel)="cancelLogout()">
  </app-confirmation-dialog>
}